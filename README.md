# Hybrid-QPSO-SA-Greedy-Algorithm-for-8-Bishops-Problem
Just for a school work,hope it can help you
##
本项目针对**8-Bishops问题**（在8×8棋盘上放置最多无冲突主教），设计并实现了一种**混合智能优化算法**——融合量子粒子群优化（QPSO）、模拟退火（SA）和贪心算法的优势，结合并行计算与高效冲突检测，最终实现：
- 稳定找到**理论最优解**（14个无冲突主教）
- 支持**多解发现**（记录多个不同的最优布局）
- **并行加速**大幅提升计算效率
- （还算）直观的结果可视化（最优解布局+收敛曲线）


# 核心特性
## 1. 混合算法框架
- **QPSO（量子粒子群优化）**：负责全局探索，通过量子概率更新机制高效搜索解空间，避免传统PSO的早熟收敛问题
- **SA（模拟退火）**：引入Metropolis准则，允许偶尔接受较差解，帮助算法跳出局部最优陷阱
- **贪心算法**：对全局最优解进行局部精炼，快速提升解质量（优先添加无冲突主教，或移除冲突最大的主教）

## 2. 性能优化
- **高效冲突检测**：复杂度（统计对角线主教数量）仅仅为O（n），替代传统O(N²) pairwise比较，计算速度提升显著
- **并行计算**：基于`ProcessPoolExecutor`实现粒子更新并行化，充分利用CPU多核处理，比串行版本快3-4倍
- **内存优化**：使用`np.int8`存储棋盘状态，减少内存占用

## 3. 功能完整性
- **多解记录**：自动检测并保存多个不同的最优解（集合去重）
- **收敛监控**：实时记录全局最优解的收敛过程，输出迭代进度条
- **结果可视化**：生成所有最优解的棋盘布局图和算法收敛曲线，直观展示优化效果

## 使用说明
### 1. 快速运行
直接运行主脚本即可启动算法求解：
```python
python 8_bishops_solver.py
```
#脚本会自动执行以下流程：
1. 初始化算法参数和粒子群
2. 并行迭代优化（QPSO+SA+贪心精炼）
3. 记录并输出最优解信息
4. 生成可视化结果（弹窗显示+图片保存）

### 2. 参数调整
若需自定义算法参数，可修改`main`函数中`solve_bishops_hybrid_sa`的调用参数：
# 示例：修改粒子数、最大迭代次数、贪心精炼间隔
```
best_board, solutions, history, solution_discovery_points = solve_bishops_hybrid_sa(
    n_particles=120,    # 粒子数（建议80-200，平衡多样性与效率）
    max_iter=300,       # 最大迭代次数（建议200-500，确保充分搜索，实测300可以稳定找到20个左右）
    alpha=0.6,          # QPSO搜索策略参数（0.4-0.7，平衡全局/局部搜索）
    greedy_interval=4   # 贪心精炼间隔（3-6，控制局部优化频率）
)
```
其他关键参数（SA相关）可在`SimulatedAnnealing`类初始化时调整：
- `initial_temp=200`：SA初始温度（150-250，影响早期探索能力）
- `cooling_rate=0.98`：SA冷却率（0.95-0.99，平衡探索与收敛）
```
```
## 算法原理
### 1. 问题建模
- **解编码**：8×8二进制矩阵（`1`表示主教，`0`表示空位）
- **约束条件**：任意两个主教不能共主对角线（`r-c=常数`）或反对角线（`r+c=常数`）
- **目标函数**：最大化主教数量，同时最小化冲突数，转化为评分函数：
  \[
  Score = n - 100 \times c
  \]
  其中`n`为主教数，`c`为冲突数（冲突重罚确保优先无冲突解）

### 2. 核心模块
#### （1）量子PSO更新
通过量子概率生成吸引子，平衡个体最优（`pbest`）和全局最优（`gbest`）：
```python
attractor = np.where(np.random.rand(*x.shape) < alpha, pbest, gbest)
new_position = np.where(np.random.rand(*x.shape) < 0.5, attractor, x)
```

#### （2）轻量模拟退火优化
每2代对粒子应用SA，通过温度控制接受较差解的概率：
\[
P_{\text{accept}} = \begin{cases} 
1 & \text{if 新解评分 > 当前解评分} \\
\exp\left(\frac{\text{新解评分} - \text{当前解评分}}{T}\right) & \text{否则}
\end{cases}
\]
其中`T`为当前温度，随迭代指数衰减。

#### （3）贪心精炼
对`gbest`进行局部优化：
1. 遍历所有空位，尝试添加主教，选择评分最高的新布局
2. 若无法添加，遍历所有主教，尝试移除，选择评分最高的新布局

#### （4）并行计算
将每个粒子的更新（QPSO+SA+评估）封装为独立任务，分配给多个CPU核心并行执行，避免GIL限制。


## 结果说明
### 1. 输出信息
运行后会在控制台输出：
- 算法参数（粒子数、迭代次数等）
- 迭代过程中的最优解发现信息（迭代次数、解编号）
- 最终结果（主教数、冲突数、评分、不同最优解数量）
- 所有最优解的棋盘布局

### 2. 可视化结果
脚本会生成名为`8_bishops_all_solutions_and_convergence.png`的图片，包含：
- 所有不同最优解的棋盘布局（黑白格+红色边框黑色主教）
- 算法收敛曲线（蓝色线为全局最优评分，红色虚线为理论最优14，绿色点为最优解发现位置）


## 总结
本项目通过混合智能算法框架，结合并行计算和高效冲突检测，成功解决了8-Bishops问题，既保证了解的质量（稳定找到理论最优），又提升了计算效率（并行加速3-4倍），同时支持多解发现和直观可视化，为类似组合优化问题提供了可复用的解决方案。
